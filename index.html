import React, { useState, useEffect } from 'react';
import { Theme } from './types';
import { LINKS_DATA } from './data';
import ThemeToggle from './components/ThemeToggle';
import LinkButton from './components/LinkButton';
import PopupModal from './components/PopupModal';

const App: React.FC = () => {
  const [theme, setTheme] = useState<Theme>(() => {
    const saved = localStorage.getItem('theme');
    return (saved === 'light' || saved === 'dark') ? saved : 'dark';
  });

  const [popupState, setPopupState] = useState<{ isOpen: boolean; index: number }>({
    isOpen: false,
    index: 0,
  });

  useEffect(() => {
    localStorage.setItem('theme', theme);
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [theme]);

  const toggleTheme = () => {
    setTheme(prev => prev === 'dark' ? 'light' : 'dark');
  };

  const openPopup = (index: number) => {
    setPopupState({ isOpen: true, index });
  };

  const closePopup = () => {
    setPopupState(prev => ({ ...prev, isOpen: false }));
  };

  const bgImage = theme === 'dark' 
    ? 'url("escuroo.jpg")'
    : 'url("clara.jpg")';

  return (
    <div 
      className="min-h-screen w-full flex items-center justify-center p-5 transition-all duration-500 bg-cover bg-center bg-no-repeat fixed inset-0"
      style={{ 
        backgroundImage: bgImage,
      }}
    >
      {/* Lighter Overlay for better visibility/cleaner look */}
      <div className={`absolute inset-0 transition-colors duration-500 ${theme === 'dark' ? 'bg-black/40' : 'bg-white/20'}`} />

      <div className="relative z-10 w-full flex justify-center py-10">
        <ThemeToggle theme={theme} toggleTheme={toggleTheme} />

        <div className="
          w-full max-w-[480px]
          bg-slate-900/40 backdrop-blur-2xl
          border border-white/20 rounded-[24px]
          p-[40px_30px] text-center
          shadow-card-glow
        ">
          {/* Avatar */}
          <div className="flex justify-center mb-5">
            <img 
              src="avatar.jpg" 
              alt="Avatar"
              className="
                w-[120px] h-[120px] rounded-full object-cover
                border-[3px] border-neon-orange/80
                shadow-avatar-glow
              "
            />
          </div>

          <h1 className="text-3xl font-extrabold text-white uppercase tracking-tight mb-2 drop-shadow-md">
            JFG Metais
          </h1>
          <p className="text-base text-gray-100 leading-relaxed mb-9 opacity-90 font-medium">
            Soluções avançadas em fixação para o futuro da construção.
          </p>

          <div className="flex flex-col w-full">
            {LINKS_DATA.map((link, idx) => (
              <LinkButton 
                key={link.id} 
                link={link} 
                onClick={() => openPopup(idx)} 
              />
            ))}
          </div>
        </div>
      </div>

      <PopupModal 
        isOpen={popupState.isOpen}
        onClose={closePopup}
        initialIndex={popupState.index}
        links={LINKS_DATA}
      />
      
      <footer className="fixed bottom-4 text-center text-white/70 text-xs w-full pointer-events-none drop-shadow-md">
        © 2025 André R. dos Santos | Interface v2.5 (React)
      </footer>
    </div>
  );
};

export default App;
